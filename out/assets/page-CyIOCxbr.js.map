{"version":3,"file":"page-CyIOCxbr.js","sources":["../../src/pages/listing-detail/page.tsx"],"sourcesContent":["\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { motion } from 'framer-motion';\r\nimport TopNavigation from '../../components/feature/TopNavigation';\r\nimport Footer from '../home/components/Footer';\r\nimport ChatBox from '../../components/feature/ChatBox';\r\nimport { supabase } from '../../lib/supabase';\r\n\r\ninterface ListingDetail {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  price: number;\r\n  category: string;\r\n  condition: string;\r\n  location: string;\r\n  images: string[];\r\n  is_premium: boolean;\r\n  views: number;\r\n  created_at: string;\r\n  user_name: string;\r\n  user_phone: string;\r\n}\r\n\r\nexport default function ListingDetailPage() {\r\n  const { id } = useParams<{ id: string }>();\r\n  const [isScrolled, setIsScrolled] = useState(false);\r\n  const [listing, setListing] = useState<ListingDetail | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const handleScroll = () => {\r\n      setIsScrolled(window.scrollY > 50);\r\n    };\r\n    window.addEventListener('scroll', handleScroll);\r\n    return () => window.removeEventListener('scroll', handleScroll);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      fetchListing();\r\n    }\r\n  }, [id]);\r\n\r\n  const fetchListing = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('listings')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      if (data) {\r\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\r\n        \r\n        // âœ… images JSON array'inden URL'leri oluÅŸtur\r\n        let imageUrls: string[] = [];\r\n        \r\n        if (data.images && Array.isArray(data.images) && data.images.length > 0) {\r\n          // images array'i varsa, path'lerden URL oluÅŸtur\r\n          imageUrls = data.images.map((imagePath: string) => \r\n            `${supabaseUrl}/storage/v1/object/public/product-images/${imagePath}`\r\n          );\r\n        } else if (data.image_url) {\r\n          // images array'i yoksa, image_url'yi kullan\r\n          imageUrls = [data.image_url];\r\n        } else {\r\n          // HiÃ§biri yoksa placeholder\r\n          imageUrls = ['https://readdy.ai/api/search-image?query=product%20placeholder%20simple%20clean%20background&width=800&height=600&seq=placeholder&orientation=landscape'];\r\n        }\r\n\r\n        console.log('ðŸ“¸ Resim URL\\'leri:', imageUrls);\r\n\r\n        setListing({\r\n          id: data.id,\r\n          title: data.title,\r\n          description: data.description || '',\r\n          price: data.price,\r\n          category: data.category,\r\n          condition: data.condition,\r\n          location: data.location,\r\n          images: imageUrls,\r\n          is_premium: data.is_premium || false,\r\n          views: data.view_count || 0,\r\n          created_at: data.created_at,\r\n          user_name: data.user_name || 'SatÄ±cÄ±',\r\n          user_phone: data.user_phone || ''\r\n        });\r\n\r\n        // Increment views\r\n        await supabase.rpc('increment_listing_views', { listing_id: id });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching listing:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatDate = (date: string) => {\r\n    const itemDate = new Date(date);\r\n    return itemDate.toLocaleDateString('tr-TR', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const handleWhatsAppContact = () => {\r\n    if (listing?.user_phone) {\r\n      const message = encodeURIComponent(`Merhaba, \"${listing.title}\" ilanÄ±nÄ±z hakkÄ±nda bilgi almak istiyorum.`);\r\n      window.open(`https://wa.me/${listing.user_phone.replace(/\\D/g, '')}?text=${message}`, '_blank');\r\n    }\r\n  };\r\n\r\n  const handleImageClick = (index: number) => {\r\n    setCurrentImageIndex(index);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-cyan-50\">\r\n        <TopNavigation isScrolled={isScrolled} />\r\n        <div className=\"pt-24 pb-16 flex items-center justify-center min-h-screen\">\r\n          <div className=\"text-center\">\r\n            <div className=\"inline-block w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mb-4\"></div>\r\n            <p className=\"text-gray-600\">Ä°lan yÃ¼kleniyor...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!listing) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-cyan-50\">\r\n        <TopNavigation isScrolled={isScrolled} />\r\n        <div className=\"pt-24 pb-16 flex items-center justify-center min-h-screen\">\r\n          <div className=\"text-center\">\r\n            <i className=\"ri-error-warning-line text-6xl text-gray-300 mb-4\" />\r\n            <h3 className=\"text-xl font-semibold text-gray-600 mb-2\">Ä°lan BulunamadÄ±</h3>\r\n            <p className=\"text-gray-500\">AradÄ±ÄŸÄ±nÄ±z ilan mevcut deÄŸil veya kaldÄ±rÄ±lmÄ±ÅŸ olabilir.</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-cyan-50\">\r\n      <TopNavigation isScrolled={isScrolled} />\r\n\r\n      <div className=\"pt-24 pb-16\">\r\n        <div className=\"max-w-7xl mx-auto px-6\">\r\n          <div className=\"grid lg:grid-cols-2 gap-8\">\r\n            {/* Image Gallery */}\r\n            <motion.div\r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              className=\"space-y-4\"\r\n            >\r\n              {/* Main Image */}\r\n              <div className=\"relative h-96 lg:h-[500px] rounded-2xl overflow-hidden bg-white shadow-lg\">\r\n                <img\r\n                  src={listing.images[currentImageIndex] || 'https://readdy.ai/api/search-image?query=product%20placeholder%20simple%20clean%20background&width=800&height=600&seq=placeholder&orientation=landscape'}\r\n                  alt={listing.title}\r\n                  className=\"w-full h-full object-cover\"\r\n                />\r\n                {listing.is_premium && (\r\n                  <div className=\"absolute top-4 right-4 px-4 py-2 bg-gradient-to-r from-amber-400 to-orange-500 text-white text-sm font-bold rounded-full flex items-center space-x-2\">\r\n                    <i className=\"ri-vip-crown-fill\" />\r\n                    <span>Premium Ä°lan</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Thumbnail Gallery */}\r\n              {listing.images.length > 1 && (\r\n                <div className=\"grid grid-cols-4 gap-3\">\r\n                  {listing.images.map((image, index) => (\r\n                    <button\r\n                      key={index}\r\n                      onClick={() => handleImageClick(index)}\r\n                      className={`relative h-24 rounded-lg overflow-hidden cursor-pointer transition-all ${\r\n                        currentImageIndex === index\r\n                          ? 'ring-4 ring-primary-500 scale-105'\r\n                          : 'hover:scale-105 opacity-70 hover:opacity-100'\r\n                      }`}\r\n                    >\r\n                      <img\r\n                        src={image}\r\n                        alt={`${listing.title} - ${index + 1}`}\r\n                        className=\"w-full h-full object-cover\"\r\n                      />\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </motion.div>\r\n\r\n            {/* Listing Details */}\r\n            <motion.div\r\n              initial={{ opacity: 0, x: 20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              className=\"space-y-6\"\r\n            >\r\n              {/* Title & Price */}\r\n              <div className=\"bg-white rounded-2xl p-6 shadow-lg\">\r\n                <div className=\"flex items-start justify-between mb-4\">\r\n                  <h1 className=\"text-3xl font-bold text-gray-900 flex-1\">\r\n                    {listing.title}\r\n                  </h1>\r\n                </div>\r\n\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <div className=\"text-4xl font-bold bg-gradient-primary bg-clip-text text-transparent\">\r\n                    {listing.price.toLocaleString('tr-TR')} â‚º\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2 text-sm text-gray-500\">\r\n                    <i className=\"ri-eye-line\" />\r\n                    <span>{listing.views} gÃ¶rÃ¼ntÃ¼lenme</span>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap gap-3 mb-6\">\r\n                  <span className=\"px-4 py-2 bg-purple-100 text-purple-700 text-sm font-medium rounded-full\">\r\n                    {listing.category}\r\n                  </span>\r\n                  <span className=\"px-4 py-2 bg-green-100 text-green-700 text-sm font-medium rounded-full\">\r\n                    {listing.condition}\r\n                  </span>\r\n                  <span className=\"px-4 py-2 bg-blue-100 text-blue-700 text-sm font-medium rounded-full flex items-center space-x-1\">\r\n                    <i className=\"ri-map-pin-line\" />\r\n                    <span>{listing.location}</span>\r\n                  </span>\r\n                </div>\r\n\r\n                <div className=\"pt-6 border-t border-gray-200\">\r\n                  <p className=\"text-sm text-gray-500 mb-1\">Ä°lan Tarihi</p>\r\n                  <p className=\"text-gray-900 font-medium\">{formatDate(listing.created_at)}</p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Description */}\r\n              {listing.description && (\r\n                <div className=\"bg-white rounded-2xl p-6 shadow-lg\">\r\n                  <h2 className=\"text-xl font-bold text-gray-900 mb-4\">AÃ§Ä±klama</h2>\r\n                  <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">\r\n                    {listing.description}\r\n                  </p>\r\n                </div>\r\n              )}\r\n\r\n              {/* Seller Info */}\r\n              <div className=\"bg-white rounded-2xl p-6 shadow-lg\">\r\n                <h2 className=\"text-xl font-bold text-gray-900 mb-4\">SatÄ±cÄ± Bilgileri</h2>\r\n                <div className=\"flex items-center space-x-4 mb-6\">\r\n                  <div className=\"w-16 h-16 bg-gradient-primary rounded-full flex items-center justify-center text-white text-2xl font-bold\">\r\n                    {listing.user_name.charAt(0).toUpperCase()}\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"font-semibold text-gray-900\">{listing.user_name}</p>\r\n                    <p className=\"text-sm text-gray-500\">SatÄ±cÄ±</p>\r\n                  </div>\r\n                </div>\r\n\r\n                {listing.user_phone && (\r\n                  <button\r\n                    onClick={handleWhatsAppContact}\r\n                    className=\"w-full py-4 bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center space-x-2 cursor-pointer whitespace-nowrap\"\r\n                  >\r\n                    <i className=\"ri-whatsapp-line text-2xl\" />\r\n                    <span>WhatsApp ile Ä°letiÅŸime GeÃ§</span>\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </motion.div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <Footer />\r\n      <ChatBox />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["ListingDetailPage","id","useParams","isScrolled","setIsScrolled","useState","listing","setListing","loading","setLoading","currentImageIndex","setCurrentImageIndex","useEffect","handleScroll","fetchListing","data","error","supabase","supabaseUrl","imageUrls","imagePath","formatDate","date","handleWhatsAppContact","message","handleImageClick","index","jsxs","jsx","TopNavigation","motion","image","Footer","ChatBox"],"mappings":"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"}