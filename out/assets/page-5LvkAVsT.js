import{u as G,r as l,j as e}from"./index-CG8BtuKQ.js";import{T as w}from"./TopNavigation-B4KEoh3H.js";import{s as i}from"./supabase-ChMZ-R7X.js";function U(){const b=G(),[g,k]=l.useState(null),[P,_]=l.useState(!0),[o,m]=l.useState(!1),[f,y]=l.useState(!1),[j,n]=l.useState(""),[N,c]=l.useState(""),[t,d]=l.useState({full_name:"",display_name:"",bio:"",location:""}),[s,u]=l.useState({phone:"",pin:"",confirmPin:""}),[A,p]=l.useState(!1);l.useEffect(()=>{S()},[]);const S=async()=>{try{const{data:{user:a}}=await i.auth.getUser();if(!a){b("/auth/login");return}k(a);const{data:r}=await i.from("profiles").select("*").eq("id",a.id).single();r&&d({full_name:r.full_name||"",display_name:r.display_name||"",bio:r.bio||"",location:r.location||""});const{data:x}=await i.from("user_security").select("*").eq("user_id",a.id).single();x&&x.pin_hash&&p(!0)}catch(a){console.error("Kullanıcı bilgileri alınamadı:",a)}finally{_(!1)}},z=async a=>{a.preventDefault(),n(""),c(""),m(!0);try{const{error:r}=await i.from("profiles").update({full_name:t.full_name,display_name:t.display_name,bio:t.bio,location:t.location}).eq("id",g.id);if(r)throw r;c("Profil bilgileriniz güncellendi!")}catch(r){n(r.message||"Profil güncellenirken hata oluştu")}finally{m(!1)}},I=async a=>{if(a.preventDefault(),n(""),c(""),!s.phone||!s.pin){n("Telefon numarası ve PIN giriniz");return}if(s.pin!==s.confirmPin){n("PIN kodları eşleşmiyor");return}if(s.pin.length!==4){n("PIN 4 haneli olmalıdır");return}m(!0);try{const x=new TextEncoder().encode(s.pin),E=await crypto.subtle.digest("SHA-256",x),W=Array.from(new Uint8Array(E)).map(X=>X.toString(16).padStart(2,"0")).join(""),{data:h,error:v}=await i.rpc("register_user_pin",{p_user_id:g.id,p_phone:s.phone,p_pin_hash:W});if(v)throw v;if(Array.isArray(h)&&h.length>0&&h[0]?.success===!1)throw new Error(h[0]?.message||"Güvenlik ayarları kaydedilirken hata oluştu");c("WhatsApp güvenlik ayarları kaydedildi!"),p(!0),u({phone:"",pin:"",confirmPin:""})}catch(r){n(r.message||"Güvenlik ayarları kaydedilirken hata oluştu")}finally{m(!1)}},D=async()=>{n(""),c(""),y(!0);try{const{data:a,error:r}=await i.rpc("reset_user_pin",{p_user_id:g.id});if(r)throw r;if(Array.isArray(a)&&a.length>0&&a[0]?.success===!1)throw new Error(a[0]?.message||"PIN sıfırlanırken hata oluştu");p(!1),u({phone:"",pin:"",confirmPin:""}),c("PIN sıfırlandı. Yeni PIN oluşturabilirsiniz.")}catch(a){n(a.message||"PIN sıfırlanırken hata oluştu")}finally{y(!1)}},C=async()=>{await i.auth.signOut(),b("/")};return P?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-white to-orange-50",children:[e.jsx(w,{}),e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-teal-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Yükleniyor..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-white to-orange-50",children:[e.jsx(w,{}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-16",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Profil Ayarları"}),e.jsx("p",{className:"text-gray-600",children:"Hesap bilgilerinizi ve güvenlik ayarlarınızı yönetin"})]}),j&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:j})}),N&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-600",children:N})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Profil Bilgileri"}),e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ad Soyad"}),e.jsx("input",{type:"text",value:t.full_name,onChange:a=>d({...t,full_name:a.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm",placeholder:"Adınız ve soyadınız"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Görünen Ad"}),e.jsx("input",{type:"text",value:t.display_name,onChange:a=>d({...t,display_name:a.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm",placeholder:"Kullanıcı adınız"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Biyografi"}),e.jsx("textarea",{value:t.bio,onChange:a=>d({...t,bio:a.target.value}),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm resize-none",placeholder:"Kendinizden bahsedin...",maxLength:500})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Konum"}),e.jsx("input",{type:"text",value:t.location,onChange:a=>d({...t,location:a.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm",placeholder:"Şehir, Ülke"})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:o?"Kaydediliyor...":"Profili Güncelle"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("i",{className:"ri-whatsapp-line text-3xl text-green-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"WhatsApp Güvenliği"}),e.jsx("p",{className:"text-sm text-gray-600",children:"İsteğe bağlı 2 katmanlı güvenlik"})]})]}),A?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-shield-check-line text-3xl text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"WhatsApp Güvenliği Aktif"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Hesabınız WhatsApp ile korunuyor"}),e.jsxs("div",{className:"flex flex-col gap-3 items-center",children:[e.jsx("button",{onClick:()=>p(!1),className:"text-sm text-teal-600 hover:text-teal-700 font-semibold cursor-pointer",disabled:o||f,children:"Ayarları Değiştir"}),e.jsx("button",{onClick:D,className:"text-sm text-red-600 hover:text-red-700 font-semibold cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",disabled:o||f,children:f?"PIN sıfırlanıyor...":"PIN'i Sıfırla"})]})]}):e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsx("div",{className:"bg-teal-50 border border-teal-200 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-teal-800",children:[e.jsx("i",{className:"ri-information-line mr-2"}),"WhatsApp güvenliği ile hesabınıza ekstra koruma ekleyin. Telefon numaranız ve PIN kodunuz ile giriş yapabilirsiniz."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefon Numarası"}),e.jsx("input",{type:"tel",value:s.phone,onChange:a=>u({...s,phone:a.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm",placeholder:"+90 5XX XXX XX XX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"4 Haneli PIN"}),e.jsx("input",{type:"password",value:s.pin,onChange:a=>u({...s,pin:a.target.value.replace(/\D/g,"").slice(0,4)}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm",placeholder:"****",maxLength:4})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PIN Tekrar"}),e.jsx("input",{type:"password",value:s.confirmPin,onChange:a=>u({...s,confirmPin:a.target.value.replace(/\D/g,"").slice(0,4)}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm",placeholder:"****",maxLength:4})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:o?"Kaydediliyor...":"WhatsApp Güvenliğini Aktifleştir"})]})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("button",{onClick:C,className:"text-red-600 hover:text-red-700 font-semibold cursor-pointer",children:[e.jsx("i",{className:"ri-logout-box-line mr-2"}),"Çıkış Yap"]})})]})]})}export{U as default};
//# sourceMappingURL=page-5LvkAVsT.js.map
