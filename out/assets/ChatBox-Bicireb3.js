import{r,j as e,R as ie,u as De}from"./index-Bhr8nl4h.js";import{s as J,a as de,c as ze}from"./supabase-BeTKJXoN.js";import{M as Me,i as Re,u as ye,P as _e,a as Te,b as Ee,L as Ae,m as L}from"./proxy-h76D_HW5.js";class Ue extends r.Component{getSnapshotBeforeUpdate(a){const t=this.props.childRef.current;if(t&&a.isPresent&&!this.props.isPresent){const c=t.offsetParent,l=Re(c)&&c.offsetWidth||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=l-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Le({children:s,isPresent:a,anchorX:t,root:c}){const l=r.useId(),i=r.useRef(null),o=r.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:y}=r.useContext(Me);return r.useInsertionEffect(()=>{const{width:w,height:u,top:d,left:x,right:N}=o.current;if(a||!i.current||!w||!u)return;const $=t==="left"?`left: ${x}`:`right: ${N}`;i.current.dataset.motionPopId=l;const z=document.createElement("style");y&&(z.nonce=y);const k=c??document.head;return k.appendChild(z),z.sheet&&z.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${w}px !important;
            height: ${u}px !important;
            ${$}px !important;
            top: ${d}px !important;
          }
        `),()=>{k.contains(z)&&k.removeChild(z)}},[a]),e.jsx(Ue,{isPresent:a,childRef:i,sizeRef:o,children:r.cloneElement(s,{ref:i})})}const Ve=({children:s,initial:a,isPresent:t,onExitComplete:c,custom:l,presenceAffectsLayout:i,mode:o,anchorX:y,root:w})=>{const u=ye(Be),d=r.useId();let x=!0,N=r.useMemo(()=>(x=!1,{id:d,initial:a,isPresent:t,custom:l,onExitComplete:$=>{u.set($,!0);for(const z of u.values())if(!z)return;c&&c()},register:$=>(u.set($,!1),()=>u.delete($))}),[t,u,c]);return i&&x&&(N={...N}),r.useMemo(()=>{u.forEach(($,z)=>u.set(z,!1))},[t]),r.useEffect(()=>{!t&&!u.size&&c&&c()},[t]),o==="popLayout"&&(s=e.jsx(Le,{isPresent:t,anchorX:y,root:w,children:s})),e.jsx(_e.Provider,{value:N,children:s})};function Be(){return new Map}const oe=s=>s.key||"";function pe(s){const a=[];return r.Children.forEach(s,t=>{r.isValidElement(t)&&a.push(t)}),a}const le=({children:s,custom:a,initial:t=!0,onExitComplete:c,presenceAffectsLayout:l=!0,mode:i="sync",propagate:o=!1,anchorX:y="left",root:w})=>{const[u,d]=Te(o),x=r.useMemo(()=>pe(s),[s]),N=o&&!u?[]:x.map(oe),$=r.useRef(!0),z=r.useRef(x),k=ye(()=>new Map),[M,Q]=r.useState(x),[T,R]=r.useState(x);Ee(()=>{$.current=!1,z.current=x;for(let E=0;E<T.length;E++){const g=oe(T[E]);N.includes(g)?k.delete(g):k.get(g)!==!0&&k.set(g,!1)}},[T,N.length,N.join("-")]);const _=[];if(x!==M){let E=[...x];for(let g=0;g<T.length;g++){const H=T[g],W=oe(H);N.includes(W)||(E.splice(g,0,H),_.push(H))}return i==="wait"&&_.length&&(E=_),R(pe(E)),Q(x),null}const{forceRender:ee}=r.useContext(Ae);return e.jsx(e.Fragment,{children:T.map(E=>{const g=oe(E),H=o&&!u?!1:x===T||N.includes(g),W=()=>{if(k.has(g))k.set(g,!0);else return;let te=!0;k.forEach(b=>{b||(te=!1)}),te&&(ee?.(),R(z.current),o&&d?.(),c&&c())};return e.jsx(Ve,{isPresent:H,initial:!$.current||t?void 0:!1,custom:a,presenceAffectsLayout:l,mode:i,root:w,onExitComplete:H?void 0:W,anchorX:y,children:E},g)})})},fe=s=>{let a;const t=new Set,c=(u,d)=>{const x=typeof u=="function"?u(a):u;if(!Object.is(x,a)){const N=a;a=d??(typeof x!="object"||x===null)?x:Object.assign({},a,x),t.forEach($=>$(a,N))}},l=()=>a,y={setState:c,getState:l,getInitialState:()=>w,subscribe:u=>(t.add(u),()=>t.delete(u))},w=a=s(c,l,y);return y},Pe=(s=>s?fe(s):fe),Fe=s=>s;function Ke(s,a=Fe){const t=ie.useSyncExternalStore(s.subscribe,ie.useCallback(()=>a(s.getState()),[s,a]),ie.useCallback(()=>a(s.getInitialState()),[s,a]));return ie.useDebugValue(t),t}const he=s=>{const a=Pe(s),t=c=>Ke(a,c);return Object.assign(t,a),t},He=(s=>s?he(s):he),ue=He((s,a)=>({user:null,customUser:null,profile:null,isLoading:!0,isAuthenticated:!1,verifySession:async()=>{try{const t=localStorage.getItem("session_token"),c=localStorage.getItem("user_id");if(!t||!c)return!1;const{data:l,error:i}=await J.functions.invoke("auth-verify",{body:{session_token:t}});if(i||!l.success)return localStorage.removeItem("session_token"),localStorage.removeItem("user_id"),s({customUser:null,isAuthenticated:!1}),!1;const{data:o}=await J.from("users").select("*").eq("id",c).single();return o?(s({customUser:o,isAuthenticated:!0}),!0):!1}catch{return!1}},checkAuth:async()=>{try{if(localStorage.getItem("session_token"))return await a().verifySession();const{data:{user:c}}=await J.auth.getUser();return c?(s({user:c,isAuthenticated:!0}),!0):!1}catch{return!1}},signIn:async(t,c)=>{try{const{data:l,error:i}=await de.signIn(t,c);if(i)return{success:!1,error:i.message};if(l.user){const{data:o}=await J.from("profiles").select("*").eq("id",l.user.id).single();s({user:l.user,profile:o,isAuthenticated:!0})}return{success:!0}}catch{return{success:!1,error:"GiriÅŸ yapÄ±lÄ±rken bir hata oluÅŸtu"}}},signUp:async(t,c,l)=>{try{const{data:i,error:o}=await de.signUp(t,c,l);return o?{success:!1,error:o.message}:(i.user&&(await J.from("profiles").insert({id:i.user.id,email:i.user.email,full_name:l,display_name:l,is_verified:!1,rating:0}),s({user:i.user,isAuthenticated:!0})),{success:!0})}catch{return{success:!1,error:"KayÄ±t olurken bir hata oluÅŸtu"}}},signOut:async()=>{localStorage.removeItem("session_token"),localStorage.removeItem("user_id"),await de.signOut(),s({user:null,customUser:null,profile:null,isAuthenticated:!1})},loadUser:async()=>{try{s({isLoading:!0});const t=localStorage.getItem("session_token"),c=localStorage.getItem("user_id");if(t&&c&&await a().verifySession()){s({isLoading:!1});return}const{data:{user:l}}=await J.auth.getUser();if(l){const{data:i}=await J.from("profiles").select("*").eq("id",l.id).single();s({user:l,profile:i,isAuthenticated:!0,isLoading:!1})}else s({user:null,customUser:null,profile:null,isAuthenticated:!1,isLoading:!1})}catch{s({user:null,customUser:null,profile:null,isAuthenticated:!1,isLoading:!1})}},updateProfile:async t=>{try{const{user:c}=a();if(!c)return{success:!1,error:"KullanÄ±cÄ± giriÅŸi gerekli"};const{data:l,error:i}=await J.from("profiles").update(t).eq("id",c.id).select().single();return i?{success:!1,error:i.message}:(s({profile:l}),{success:!0})}catch{return{success:!1,error:"Profil gÃ¼ncellenirken bir hata oluÅŸtu"}}}}));J.auth.onAuthStateChange((s,a)=>{s==="SIGNED_IN"&&a?.user?ue.getState().loadUser():s==="SIGNED_OUT"&&ue.setState({user:null,customUser:null,profile:null,isAuthenticated:!1})});function Oe({onTranscriptReady:s,onResponseReceived:a,isEnabled:t=!0,selectedVoice:c=null}){const[l,i]=r.useState(!1),[o,y]=r.useState(""),[w,u]=r.useState(""),[d,x]=r.useState(!1),[N,$]=r.useState(null),[z,k]=r.useState(!1),[M,Q]=r.useState(null),T=c||M,R=r.useRef(null),_=r.useRef(null);r.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const b=window.webkitSpeechRecognition||window.SpeechRecognition;R.current=new b,R.current.lang="tr-TR",R.current.continuous=!0,R.current.interimResults=!0,R.current.onresult=async p=>{let f="";for(let v=0;v<p.results.length;v++)p.results[v].isFinal&&(f+=p.results[v][0].transcript);if(f){y(f);const v=H(f);u(v),s(v),E()}},R.current.onerror=p=>{console.error("Speech recognition error:",p.error),$(`Ses tanÄ±ma hatasÄ±: ${p.error}`),i(!1)},R.current.onend=()=>{i(!1)}}else $("TarayÄ±cÄ±nÄ±z ses tanÄ±mayÄ± desteklemiyor. Chrome veya Edge kullanÄ±n.");if(_.current=window.speechSynthesis,!c){const b=()=>{const f=(_.current?.getVoices()||[]).filter(v=>v.lang.startsWith("tr"));if(f.length>0&&!M){const v=f.find(S=>S.name.includes("Emel"))||f.find(S=>S.name.toLowerCase().includes("female"))||f[f.length>1?1:0];Q(v),console.log("ğŸ¤ Default voice selected:",v.name)}};b(),setTimeout(b,100),_.current&&(_.current.onvoiceschanged=b)}return()=>{R.current&&R.current.stop(),_.current&&_.current.cancel()}},[T]);const ee=()=>{if(t&&($(null),y(""),u(""),R.current))try{R.current.start(),i(!0)}catch(b){console.error("Failed to start recognition:",b),$("Mikrofon baÅŸlatÄ±lamadÄ±. Ä°zin verdiÄŸinizden emin olun.")}},E=()=>{R.current&&R.current.stop(),i(!1)},g=b=>{const p=["","bir","iki","Ã¼Ã§","dÃ¶rt","beÅŸ","altÄ±","yedi","sekiz","dokuz"],f=["","on","yirmi","otuz","kÄ±rk","elli","altmÄ±ÅŸ","yetmiÅŸ","seksen","doksan"],v=["","yÃ¼z","iki yÃ¼z","Ã¼Ã§ yÃ¼z","dÃ¶rt yÃ¼z","beÅŸ yÃ¼z","altÄ± yÃ¼z","yedi yÃ¼z","sekiz yÃ¼z","dokuz yÃ¼z"];if(b===0)return"sÄ±fÄ±r";if(b<10)return p[b];if(b<100){const S=Math.floor(b/10),C=b%10;return f[S]+(C>0?" "+p[C]:"")}if(b<1e3){const S=Math.floor(b/100),C=b%100;return v[S]+(C>0?" "+g(C):"")}return b.toString()},H=b=>{const p={sitroen:"Citroen",citron:"Citroen",stroen:"Citroen",reno:"Renault",porÅŸe:"Porsche",mersedes:"Mercedes",bÄ±mvÄ±:"BMW",foksvagen:"Volkswagen",toyta:"Toyota",pejo:"Peugeot",hundai:"Hyundai",ayfon:"iPhone",aypad:"iPad",samsÄ±ng:"Samsung",huavey:"Huawei",ÅŸiyomi:"Xiaomi","kelvin klein":"Calvin Klein","calvin klein":"Calvin Klein","selin dion":"Celine Dion","selin diyor":"Celine Dior",poison:"Poison",poyzÄ±n:"Poison",diyor:"Dior",ÅŸanel:"Chanel",lankÃ¶m:"LancÃ´me",gucci:"Gucci",versaÃ§e:"Versace","hugo boss":"Hugo Boss",lakost:"Lacoste",lakos:"Lacoste",lagos:"Lacoste"};let f=b;for(const[v,S]of Object.entries(p)){const C=new RegExp(`\\b${v}\\b`,"gi");f=f.replace(C,S)}return f},W=r.useCallback(b=>{if(!_.current||!t)return;let p=b;if(p=p.replace(/([A-Za-zÃ‡ÄÄ°Ã–ÅÃœÃ§ÄŸÄ±Ã¶ÅŸÃ¼Ä°Ä±]+)(\d+)/g,"$1 $2").replace(/(\d+)([A-Za-zÃ‡ÄÄ°Ã–ÅÃœÃ§ÄŸÄ±Ã¶ÅŸÃ¼Ä°Ä±]+)/g,"$1 $2"),p=p.replace(/\b(\d{1,3})\s*'?nolu\b/gi,(v,S)=>{const C=parseInt(S,10);return Number.isFinite(C)?`${g(C)} numaralÄ±`:`${S} numaralÄ±`}),p=p.replace(/([A-Za-zÃ‡ÄÄ°Ã–ÅÃœÃ§ÄŸÄ±Ã¶ÅŸÃ¼Ä°Ä±]{2,})\s+(\d{1,2})\b/g,(v,S,C)=>{const V=parseInt(C,10);return Number.isFinite(V)?`${S} ${g(V)}`:`${S} ${C}`}),p=p.replace(/\+90(\d{3})(\d{3})(\d{4})/g,(v,S,C,V)=>{const B=["sÄ±fÄ±r","bir","iki","Ã¼Ã§","dÃ¶rt","beÅŸ","altÄ±","yedi","sekiz","dokuz"],X=S.split("").map(P=>B[parseInt(P)]).join(" "),F=C.split("").map(P=>B[parseInt(P)]).join(" "),se=V.split("").map(P=>B[parseInt(P)]).join(" ");return`telefon: ${X}, ${F}, ${se}`}),p=p.replace(/\b0(\d{3})(\d{3})(\d{4})\b/g,(v,S,C,V)=>{const B=["sÄ±fÄ±r","bir","iki","Ã¼Ã§","dÃ¶rt","beÅŸ","altÄ±","yedi","sekiz","dokuz"],X=S.split("").map(P=>B[parseInt(P)]).join(" "),F=C.split("").map(P=>B[parseInt(P)]).join(" "),se=V.split("").map(P=>B[parseInt(P)]).join(" ");return`telefon: ${X}, ${F}, ${se}`}),p=p.replace(/\b(\d{3,6})\s*(â‚º|TL|lira)?\b/gi,(v,S,C)=>{const V=parseInt(S);if(V>=1e3){const B=Math.floor(V/1e3),X=V%1e3;let F="";return B>0&&(F+=`${B===1?"bin":g(B)+" bin"}`),X>0&&(F+=` ${g(X)}`),F+(C?" lira":"")}return g(V)+(C?" lira":"")}),p=p.replace(/^https?:\/\/[^\s]+$/gm,"").replace(/FotoÄŸraflar:\s*/g,"").replace(/https?:\/\/[^\s]+/g,"").replace(/[\u{1F000}-\u{1FFFF}]/gu,"").replace(/[\u{2600}-\u{27BF}]/gu,"").replace(/[\u{FE0F}\u{200D}]/gu,"").replace(/\d\u{FE0F}?\u{20E3}/gu,"").replace(/^"([^"]+)"\s*$/gm,"").replace(/\n{3,}/g,`

`).replace(/\s+/g," ").trim(),!p)return;_.current.cancel();const f=new SpeechSynthesisUtterance(p);f.lang="tr-TR",f.rate=1.1,f.pitch=1,f.volume=1,T&&(f.voice=T),f.onstart=()=>k(!0),f.onend=()=>k(!1),f.onerror=v=>{console.error("ğŸ”Š Speech error:",v),k(!1)},_.current.speak(f)},[t,T]),te=()=>{_.current&&(_.current.cancel(),k(!1))};return r.useEffect(()=>(t&&(console.log("âœ… VoiceChat: Exposing speak function"),window.speakResponse=W),()=>{console.log("ğŸ—‘ï¸ VoiceChat: Cleaning up speak function"),delete window.speakResponse}),[t,W]),e.jsxs("div",{className:"voice-chat-container relative flex items-center gap-2",children:[e.jsxs(L.button,{onClick:l?E:ee,disabled:!t||d,title:l?"Dinlemeyi Durdur":"KonuÅŸmaya BaÅŸla",className:`relative w-10 h-10 rounded-full flex items-center justify-center transition-all ${l?"bg-red-500 hover:bg-red-600 shadow-lg shadow-red-500/50":"bg-gradient-to-r from-purple-500 to-cyan-500 hover:shadow-lg hover:shadow-purple-500/50"} ${!t||d?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,whileHover:{scale:t&&!d?1.05:1},whileTap:{scale:t&&!d?.95:1},animate:l?{scale:[1,1.1,1]}:{},transition:l?{repeat:1/0,duration:1.5}:{},children:[e.jsx("i",{className:`${l?"ri-stop-circle-line":"ri-mic-line"} text-xl text-white`}),l&&e.jsx(L.div,{className:"absolute inset-0 rounded-full border-2 border-red-300",animate:{scale:[1,1.5],opacity:[1,0]},transition:{repeat:1/0,duration:1.5}})]}),e.jsx(le,{children:(o||w||N||d)&&e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute bottom-14 right-0 max-w-xs bg-white rounded-2xl shadow-2xl p-4 space-y-2 z-50",children:[N&&e.jsxs("div",{className:"text-sm text-red-600 flex items-start gap-2",children:[e.jsx("i",{className:"ri-error-warning-line text-lg mt-0.5"}),e.jsx("span",{children:N})]}),d&&e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx("i",{className:"ri-loader-4-line text-lg animate-spin"}),e.jsx("span",{children:"Metin dÃ¼zeltiliyor..."})]}),o&&!d&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Ham Metin:"}),e.jsx("div",{className:"text-sm text-gray-700 italic",children:o})]}),w&&!d&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-xs text-green-600 font-medium flex items-center gap-1",children:[e.jsx("i",{className:"ri-check-line"}),"DÃ¼zeltilmiÅŸ:"]}),e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:w})]})]})}),e.jsx(le,{children:z&&e.jsx(L.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:te,title:"KonuÅŸmayÄ± Durdur",className:"absolute bottom-14 right-0 w-10 h-10 bg-orange-500 hover:bg-orange-600 rounded-full flex items-center justify-center shadow-lg cursor-pointer z-50",children:e.jsx("i",{className:"ri-volume-up-line text-lg text-white animate-pulse"})})})]})}function We({selectedVoice:s,onVoiceSelect:a}){const[t,c]=r.useState([]),[l,i]=r.useState(!1);return r.useEffect(()=>{const o=()=>{const y=window.speechSynthesis?.getVoices()||[];console.log("ğŸ¤ Available voices:",y.length,"voices loaded");const w=y.filter(d=>d.lang.startsWith("tr")&&!d.name.toLowerCase().includes("tolga")),u=w.length>0?w:y.filter(d=>!d.name.toLowerCase().includes("tolga"));console.log("ğŸ¤ Using",u.length,"voices for selection (Tolga filtered out)"),c(u)};return o(),setTimeout(o,100),setTimeout(o,500),window.speechSynthesis&&(window.speechSynthesis.onvoiceschanged=o),()=>{window.speechSynthesis&&(window.speechSynthesis.onvoiceschanged=null)}},[]),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>i(!l),title:t.length>0?"Ses SeÃ§imi":"Sesler yÃ¼kleniyor...",className:"w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors",children:e.jsx("i",{className:"ri-user-voice-line text-xl text-white/80"})}),l&&e.jsxs(L.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},className:"absolute top-12 right-0 bg-gray-800 rounded-lg shadow-xl p-3 w-[320px] max-h-[300px] overflow-y-auto overflow-x-hidden z-[9999]",children:[e.jsxs("div",{className:"text-xs text-gray-400 px-2 py-1 font-semibold border-b border-gray-700 mb-2",children:["Ses SeÃ§in: ",t.length>0?`(${t.length} ses)`:"YÃ¼kleniyor..."]}),t.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:"Sesler yÃ¼kleniyor..."}):t.map((o,y)=>{const u=o.name.toLowerCase().includes("female")||o.name.toLowerCase().includes("kadÄ±n")||o.name.toLowerCase().includes("woman")||o.name.toLowerCase().includes("emel")?"â™€ï¸":"â™‚ï¸";return e.jsxs("button",{onClick:()=>{a(o),i(!1),console.log("ğŸ¤ Voice selected:",o.name)},className:`w-full px-4 py-2.5 rounded-md hover:bg-white/10 transition-all text-sm flex items-center gap-3 ${s?.name===o.name?"bg-purple-500/30 text-white font-medium":"text-gray-300"}`,children:[e.jsx("span",{className:"text-base flex-shrink-0",children:u}),e.jsx("span",{className:"flex-1 text-left leading-tight",children:o.name})]},y)})]})]})}const we="https://snovwbffwvmkgjulrtsm.supabase.co",Ge="sb_publishable_KnNgGqX6WiisueP_EQVQ-w_2wtzxKmk",qe=ze(we,Ge),ge="product-images",xe=()=>{let s=localStorage.getItem("web_user_id");return s||(s=`web_user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("web_user_id",s)),s},Ze=s=>{const a=s.match(/\[SEARCH_CACHE\]({.*})/s);if(a)try{const t=JSON.parse(a[1]);return{cleanContent:s.replace(/\[SEARCH_CACHE\].*$/s,"").trim(),listings:t.results||[]}}catch(t){console.error("Failed to parse listings:",t)}return{cleanContent:s,listings:[]}},Je=async(s,a=.9)=>new Promise((t,c)=>{const l=new FileReader;l.readAsDataURL(s),l.onload=i=>{const o=new Image;o.src=i.target?.result,o.onload=()=>{const y=document.createElement("canvas");let w=o.width,u=o.height;const d=1920;w>u&&w>d?(u=u*d/w,w=d):u>d&&(w=w*d/u,u=d),y.width=w,y.height=u,y.getContext("2d")?.drawImage(o,0,0,w,u);let N=.9;const $=a*1024*1024,z=k=>{y.toBlob(M=>{if(!M){c(new Error("Resim sÄ±kÄ±ÅŸtÄ±rÄ±lamadÄ±"));return}if(M.size>$&&k>.1)z(k-.1);else{const Q=new File([M],s.name,{type:"image/jpeg",lastModified:Date.now()});t(Q)}},"image/jpeg",k)};z(N)},o.onerror=()=>c(new Error("Resim yÃ¼klenemedi"))},l.onerror=()=>c(new Error("Dosya okunamadÄ±"))});function et(){const s=De(),{user:a,customUser:t,profile:c,checkAuth:l}=ue(),[i,o]=r.useState(!1),[y,w]=r.useState("listing"),[u,d]=r.useState([{id:"1",type:"ai",content:"Merhaba! Ben PazarAI. Size nasÄ±l yardÄ±mcÄ± olabilirim? Ä°lan vermek iÃ§in fotoÄŸraf gÃ¶nderebilir veya Ã¼rÃ¼nÃ¼nÃ¼zÃ¼ anlatabilirsiniz.",timestamp:new Date}]),[x,N]=r.useState(""),[$,z]=r.useState(!1),[k,M]=r.useState(!1),[Q,T]=r.useState(!1),[R,_]=r.useState(null),[ee,E]=r.useState(3),[g,H]=r.useState(!1),[W,te]=r.useState(null),b=r.useRef(null),p=r.useRef(null),f=r.useRef(""),v=r.useRef([]),S="https://pazarglobal-agent-backend-production-4ec8.up.railway.app",C=n=>n?.replace(/[^a-zA-Z0-9_-]/g,"")||"web-user",V=async(n,m)=>{const I=C(m),A=`${crypto.randomUUID?.()||Date.now()}-${n.name.replace(/\s+/g,"-")}`,h=`${I}/${A}`,{error:D}=await qe.storage.from(ge).upload(h,n,{contentType:n.type,upsert:!1});if(D)throw new Error(D.message);const j=`${we}/storage/v1/object/public/${ge}/${h}`;return{storagePath:h,publicUrl:j}},B=()=>{b.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{B()},[u]),r.useEffect(()=>{l()},[l]);const X=n=>{s(`/listing/${n}`),o(!1)},F=async(n,m)=>{M(!0),T(!0),_(null),f.current="";const I=localStorage.getItem("session_token"),A=localStorage.getItem("user_id"),h=t?.id||a?.id||A||xe(),D={user_id:h,session_token:I||void 0,email:a?.email||t?.email||void 0,phone:t?.phone||void 0,name:c?.full_name||t?.full_name||a?.user_metadata?.full_name||void 0,source:"web-chat"};v.current.push({role:"user",content:n});try{m?.mediaPaths&&(console.log("ğŸ–¼ï¸  Sending media_paths to backend:",m.mediaPaths),console.log("ğŸ–¼ï¸  Sending media_type to backend:",m.mediaType));const j=await fetch(`${S}/web-chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n,user_id:h,conversation_history:v.current,user_context:D,media_paths:m?.mediaPaths,media_type:m?.mediaType})});if(!j.ok){const ae=await j.text();throw console.error("Backend error response:",ae),new Error(`Backend hatasÄ± (${j.status}): ${ae||"Bilinmeyen hata"}`)}T(!1);const U=j.headers.get("content-type");if(!U?.includes("text/event-stream"))throw console.error("Invalid content type:",U),new Error("Backend yanlÄ±ÅŸ format dÃ¶ndÃ¼. SSE bekleniyor.");const O=j.body?.getReader(),ne=new TextDecoder;if(!O)throw new Error("Response body okunamÄ±yor");let G=Date.now().toString(),ce="";for(;;){const{done:ae,value:Ie}=await O.read();if(ae){const{cleanContent:q,listings:K}=Ze(f.current);q&&v.current.push({role:"assistant",content:q}),d(re=>{const Y=[...re],Z=Y.findIndex($e=>$e.id===G);return Z>=0&&(Y[Z]={...Y[Z],content:q,listings:K.length>0?K:void 0}),Y}),M(!1),g&&window.speakResponse&&q&&(console.log("ğŸ”Š Speaking response immediately after streaming..."),setTimeout(()=>window.speakResponse(q),100));break}ce+=ne.decode(Ie,{stream:!0});const me=ce.split(`
`);ce=me.pop()||"";for(const q of me)if(q.startsWith("data: "))try{const K=JSON.parse(q.slice(6));if(K.type==="text"&&K.content)f.current+=K.content,d(re=>{const Y=re.findIndex(Z=>Z.id===G);if(Y>=0){const Z=[...re];return Z[Y]={...Z[Y],content:f.current},Z}else return[...re,{id:G,type:"ai",content:f.current,timestamp:new Date}]});else if(K.type==="done")M(!1);else if(K.type==="error")throw new Error(K.content||"Backend hatasÄ± oluÅŸtu")}catch(K){console.error("SSE parse hatasÄ±:",K,"Line:",q)}}}catch(j){console.error("Agent baÄŸlantÄ± hatasÄ±:",j);let U="BaÄŸlantÄ± hatasÄ±. LÃ¼tfen tekrar deneyin.";j.name==="TypeError"&&j.message.includes("fetch")?U="Backend'e ulaÅŸÄ±lamÄ±yor. CORS veya network hatasÄ± olabilir.":j.message&&(U=j.message),_(U),M(!1),T(!1);const O={id:(Date.now()+1).toString(),type:"ai",content:"âš ï¸ ÃœzgÃ¼nÃ¼m, ÅŸu anda baÄŸlantÄ± kuramÄ±yorum. Backend servisi Ã§alÄ±ÅŸÄ±yor mu kontrol edin. LÃ¼tfen daha sonra tekrar deneyin.",timestamp:new Date};d(ne=>[...ne,O])}},se=()=>{if(!x.trim())return;const n={id:Date.now().toString(),type:"user",content:x,timestamp:new Date};d(I=>[...I,n]);const m=x;N(""),F(m)},P=n=>{const I={create:"Yeni bir ilan oluÅŸturmak istiyorum",price:"ÃœrÃ¼nÃ¼m iÃ§in fiyat Ã¶nerisi alabilir miyim?",improve:"Ä°lan metnini iyileÅŸtirmek istiyorum",search:"TÃ¼m ilanlarÄ± gÃ¶ster",seller:"SatÄ±cÄ± bulmak istiyorum",help:"YardÄ±m almak istiyorum"}[n];if(I){const A={id:Date.now().toString(),type:"user",content:I,timestamp:new Date};d(h=>[...h,A]),F(I)}},be=()=>{p.current?.click()},ve=n=>{const m=n.target.files?.[0];if(m){const I=m.size/1048576;if(m.type.startsWith("image/")){const A=async h=>{const D=t?.id||a?.id||localStorage.getItem("user_id")||xe();try{M(!0);const{storagePath:j,publicUrl:U}=await V(h,D),O={id:Date.now().toString(),type:"user",content:`ğŸ“· ${h.name} yÃ¼klendi (${(h.size/(1024*1024)).toFixed(2)} MB)`,timestamp:new Date};d(G=>[...G,O]),console.log("ğŸ“¸ Uploading image - storagePath:",j,"publicUrl:",U),F(`FotoÄŸraf yÃ¼kledim: ${h.name}`,{mediaPaths:[j],mediaType:h.type});const ne={id:(Date.now()+2).toString(),type:"ai",content:"ğŸ“¥ GÃ¶rsel yÃ¼klendi, Ã¼rÃ¼n analizi baÅŸlatÄ±lÄ±yor...",timestamp:new Date};d(G=>[...G,ne])}catch(j){console.error("Upload error:",j);const U={id:(Date.now()+3).toString(),type:"ai",content:`âš ï¸ GÃ¶rsel yÃ¼klenemedi: ${j?.message||"Bilinmeyen hata"}`,timestamp:new Date};d(O=>[...O,U])}finally{M(!1)}};if(I>.9){M(!0);const h={id:Date.now().toString(),type:"user",content:`ğŸ“· ${m.name} iÅŸleniyor...`,timestamp:new Date};d(D=>[...D,h]),Je(m,.9).then(D=>{const j=(D.size/1048576).toFixed(2),U={id:Date.now().toString(),type:"user",content:`ğŸ“· ${m.name} yÃ¼klendi (${j} MB)`,timestamp:new Date};d(O=>[...O.filter(G=>G.id!==h.id),U]),A(D)}).catch(D=>{console.error("Resim sÄ±kÄ±ÅŸtÄ±rma hatasÄ±:",D);const j={id:(Date.now()+1).toString(),type:"ai",content:"âš ï¸ Resim iÅŸlenirken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.",timestamp:new Date};d(U=>[...U,j]),M(!1)})}else A(m)}else if(m.type.startsWith("video/")){if(I>5){const h={id:Date.now().toString(),type:"ai",content:`âš ï¸ ${m.name} Ã§ok bÃ¼yÃ¼k! Videolar maksimum 5 MB olmalÄ±dÄ±r. (Mevcut: ${I.toFixed(2)} MB)`,timestamp:new Date};d(D=>[...D,h]);return}const A={id:Date.now().toString(),type:"user",content:`ğŸ¥ ${m.name} yÃ¼klendi (${I.toFixed(2)} MB)`,timestamp:new Date};d(h=>[...h,A]),M(!0),setTimeout(()=>{const h={id:(Date.now()+1).toString(),type:"ai",content:"Video yÃ¼kleme Ã¶zelliÄŸi yakÄ±nda aktif olacak!",timestamp:new Date};d(D=>[...D,h]),M(!1)},1500)}else{const A={id:Date.now().toString(),type:"ai",content:"âš ï¸ Sadece resim ve video dosyalarÄ± yÃ¼kleyebilirsiniz.",timestamp:new Date};d(h=>[...h,A])}}},ke=()=>{H(!g)},je=n=>{const m={id:Date.now().toString(),type:"user",content:n,timestamp:new Date};d(I=>[...I,m]),F(n)},Se=[{id:"create",icon:"ri-add-circle-line",label:"Ä°lan OluÅŸtur",color:"from-purple-500 to-blue-500"},{id:"search",icon:"ri-search-line",label:"Ä°lan Ara",color:"from-cyan-500 to-green-500"},{id:"improve",icon:"ri-edit-line",label:"Metni Ä°yileÅŸtir",color:"from-orange-500 to-pink-500"}],Ne=n=>{const m="https://snovwbffwvmkgjulrtsm.supabase.co",I=n.signed_images?.map(h=>h.startsWith("http")?h:`${m}/storage/v1/object/public/product-images/${h}`)||[],A=I[0]||"https://readdy.ai/api/search-image?query=product%20placeholder%20simple%20clean%20background&width=400&height=300&seq=placeholder&orientation=landscape";return e.jsxs("div",{onClick:()=>X(n.id),className:"bg-white rounded-lg p-3 shadow-sm hover:shadow-md transition-all cursor-pointer border border-gray-100",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-24 h-24 flex-shrink-0 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:A,alt:n.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1 truncate",children:n.title}),e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:[n.price?.toLocaleString("tr-TR")," â‚º"]})}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-2",children:[e.jsx("i",{className:"ri-map-pin-line mr-1"}),n.location]}),n.category&&e.jsx("span",{className:"inline-block px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full",children:n.category})]})]}),I.length>1&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex space-x-2 overflow-x-auto",children:[I.slice(0,3).map((h,D)=>e.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",onClick:j=>j.stopPropagation(),className:"w-16 h-16 flex-shrink-0 rounded-md overflow-hidden bg-gray-100 hover:ring-2 hover:ring-purple-500 transition-all",children:e.jsx("img",{src:h,alt:`${n.title} - ${D+1}`,className:"w-full h-full object-cover"})},D)),I.length>3&&e.jsxs("div",{className:"w-16 h-16 flex-shrink-0 rounded-md bg-gray-100 flex items-center justify-center text-xs text-gray-600 font-medium",children:["+",I.length-3]})]})})]},n.id)},Ce=n=>e.jsxs("div",{className:"space-y-3 mt-2",children:[n.slice(0,ee).map(m=>Ne(m)),n.length>ee&&e.jsxs("button",{onClick:()=>E(m=>m+3),className:"w-full py-2 text-sm text-purple-600 hover:text-purple-700 font-medium transition-colors",children:["Daha fazla gÃ¶ster (",n.length-ee," ilan daha)"]})]});return e.jsxs(e.Fragment,{children:[e.jsx(le,{children:!i&&e.jsx(L.button,{initial:{scale:0},animate:{scale:1},exit:{scale:0},onClick:()=>o(!0),className:"fixed bottom-6 right-6 w-16 h-16 bg-gradient-primary rounded-full shadow-2xl flex items-center justify-center z-50 hover:scale-110 transition-transform animate-pulse-slow cursor-pointer",children:e.jsx("i",{className:"ri-chat-ai-line text-3xl text-white"})})}),e.jsx(le,{children:i&&e.jsxs(L.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},className:"fixed bottom-6 right-6 w-[440px] h-[700px] bg-white rounded-3xl shadow-2xl z-50 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-primary p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-robot-2-fill text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold",children:"PazarAI Asistan"}),e.jsxs("div",{className:"flex items-center space-x-1 text-white/80 text-xs",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${Q?"bg-yellow-400":"bg-green-400"} animate-pulse`}),e.jsx("span",{children:Q?"BaÄŸlanÄ±yor...":"Ã‡evrimiÃ§i"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g&&e.jsx(We,{selectedVoice:W,onVoiceSelect:te}),e.jsx("button",{onClick:ke,title:g?"Sesli Modu Kapat":"Sesli Modu AÃ§",className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors cursor-pointer ${g?"bg-white/30 text-white":"hover:bg-white/20 text-white/80"}`,children:e.jsx("i",{className:`${g?"ri-volume-up-fill":"ri-volume-mute-line"} text-xl`})}),e.jsx("button",{onClick:()=>o(!1),title:"KÃ¼Ã§Ã¼lt",className:"w-8 h-8 hover:bg-white/20 rounded-full flex items-center justify-center transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-subtract-line text-white text-xl"})}),e.jsx("button",{onClick:()=>o(!1),title:"Kapat",className:"w-8 h-8 hover:bg-white/20 rounded-full flex items-center justify-center transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-white text-xl"})})]})]}),e.jsx("div",{className:"flex border-b border-gray-200 bg-gray-50",children:[{id:"general",label:"Genel Sohbet"},{id:"listing",label:"Ä°lan AsistanÄ±"},{id:"support",label:"Destek"}].map(n=>e.jsxs("button",{onClick:()=>w(n.id),className:`flex-1 py-3 text-sm font-medium transition-colors relative whitespace-nowrap cursor-pointer ${y===n.id?"text-purple-600":"text-gray-600 hover:text-gray-900"}`,children:[n.label,y===n.id&&e.jsx(L.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-primary"})]},n.id))}),R&&e.jsxs(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border-b border-red-200 px-4 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("i",{className:"ri-error-warning-line text-red-500"}),e.jsx("span",{className:"text-sm text-red-700",children:R})]}),e.jsx("button",{onClick:()=>_(null),className:"text-red-500 hover:text-red-700 cursor-pointer","aria-label":"HatayÄ± kapat",children:e.jsx("i",{className:"ri-close-line"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[u.map(n=>e.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${n.type==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"max-w-[85%] space-y-2",children:[e.jsx("div",{className:`rounded-2xl px-4 py-3 ${n.type==="user"?"bg-gradient-primary text-white":"bg-white text-gray-800 shadow-md"}`,children:e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:n.content.replace(/FotoÄŸraflar:\s*https?:\/\/[^\s]+/g,"").replace(/https?:\/\/[^\s]+/g,"").replace(/\n{3,}/g,`

`).trim()})}),n.listings&&n.listings.length>0&&Ce(n.listings)]})},n.id)),k&&e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start",children:e.jsx("div",{className:"bg-white rounded-2xl px-4 py-3 shadow-md",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce [animation-delay:200ms]"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce [animation-delay:400ms]"})]})})}),y==="listing"&&u.length<=2&&!k&&e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx("p",{className:"text-xs text-gray-500 text-center mb-3",children:"HÄ±zlÄ± Ä°ÅŸlemler"}),Se.map((n,m)=>e.jsxs(L.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:m*.1},onClick:()=>P(n.id),className:`w-full py-3 px-4 bg-gradient-to-r ${n.color} text-white rounded-xl hover:shadow-lg transition-all flex items-center space-x-3 whitespace-nowrap cursor-pointer`,children:[e.jsx("i",{className:`${n.icon} text-xl`}),e.jsx("span",{className:"text-sm font-medium",children:n.label})]},m))]}),e.jsx("div",{ref:b})]}),e.jsxs("div",{className:"p-4 bg-white border-t border-gray-200",children:[$&&e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mb-3 flex items-center justify-center space-x-3 py-2",children:[e.jsx("div",{className:"flex space-x-1",children:[...Array(5)].map((n,m)=>e.jsx(L.div,{className:"w-1 bg-red-500 rounded-full",animate:{height:[8,24,8]},transition:{duration:.8,repeat:1/0,delay:m*.1}},m))}),e.jsx("span",{className:"text-sm text-red-500 font-medium",children:"Kaydediliyor..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"file",ref:p,onChange:ve,accept:"image/*",className:"hidden","aria-label":"FotoÄŸraf seÃ§"}),e.jsx("button",{onClick:be,disabled:k,className:"w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100 rounded-full transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"FotoÄŸraf yÃ¼kle",children:e.jsx("i",{className:"ri-attachment-line text-xl"})}),e.jsx("textarea",{value:x,onChange:n=>N(n.target.value),onKeyDown:n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),se())},placeholder:g?"ğŸ¤ Sesli mod aktif - Mikrofona konuÅŸun veya yazÄ±n":"MesajÄ±nÄ±zÄ± yazÄ±n...",disabled:k,className:"flex-1 px-4 py-2 border border-gray-300 rounded-full resize-none focus:outline-none focus:border-purple-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm",rows:1}),g&&e.jsx("div",{className:"relative",children:e.jsx(Oe,{onTranscriptReady:je,isEnabled:g,selectedVoice:W})}),e.jsx("button",{onClick:se,disabled:!x.trim()||k,title:"GÃ¶nder",className:"w-10 h-10 bg-gradient-primary text-white rounded-full flex items-center justify-center hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",children:e.jsx("i",{className:"ri-send-plane-fill text-lg"})})]})]})]})})]})}export{le as A,et as C,ue as u};
//# sourceMappingURL=ChatBox-Bicireb3.js.map
